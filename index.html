<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Video Builder with Zoom</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #330072;
            --primary-dark: #1e0042;
            --accent: #E87D0D;
            --success: #41B6E6;
            --info: #9678D3;
            --warning: #ffa94d;
            --bg-dark: #0f1419;
            --bg-mid: #1a1f2e;
            --bg-light: #252b3d;
            --text-white: #ffffff;
            --text-gray: #a8b2c1;
            --border: #2d3548;
            --hpu-purple: #330072;
            --hpu-light-purple: #9678D3;
            --hpu-blue: #41B6E6;
            --hpu-orange: #E87D0D;
            --hpu-silver: #818183;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--bg-mid);
            border-bottom: 2px solid var(--primary);
            padding: 20px 0;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            letter-spacing: -0.02em;
        }
        
        header h1 {
            background: none !important;
            -webkit-background-clip: unset !important;
            -webkit-text-fill-color: #FFFFFF !important;
            background-clip: unset !important;
            color: #FFFFFF !important;
        }

        .subtitle {
            text-align: center;
            color: var(--text-gray);
            margin-top: 10px;
            font-size: 1.1rem;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 15px 30px;
            background: var(--bg-mid);
            border: 2px solid var(--border);
            color: var(--text-white);
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }

        .mode-btn:hover {
            border-color: var(--primary);
            background: var(--bg-light);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 4px 20px rgba(45, 91, 214, 0.4);
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--bg-mid);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid var(--border);
        }

        .panel h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .video-source-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }

        .tab-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--bg-light);
        }

        .upload-area.drag-over {
            border-color: var(--accent);
            background: rgba(255, 107, 107, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        input[type="file"] {
            display: none;
        }

        .youtube-input {
            display: none;
        }

        .youtube-input.active {
            display: block;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .video-clickable {
            position: relative;
            cursor: crosshair;
        }

        .video-clickable.selecting {
            outline: 3px solid var(--accent);
        }

        .click-overlay {
            background: rgba(255, 107, 107, 0.1);
            transition: all 0.3s ease;
        }
        
        .click-overlay:hover {
            background: rgba(255, 107, 107, 0.2);
        }

        video, iframe {
            width: 100%;
            display: block;
            max-height: 400px;
        }

        iframe {
            height: 400px;
            border: none;
            pointer-events: none;
        }

        .zoom-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .zoom-marker {
            position: absolute;
            border: 3px solid var(--accent);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            pointer-events: none;
        }

        .zoom-marker.box {
            border-radius: 8px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .video-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            background: var(--primary);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }

        .control-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .control-btn.selecting {
            background: var(--accent);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .time-display {
            background: var(--bg-dark);
            padding: 10px 15px;
            border-radius: 8px;
            font-family: 'Courier Prime', monospace;
            font-weight: 700;
            color: var(--accent);
        }

        .type-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-dark);
            border-radius: 12px;
        }

        .type-toggle-btn {
            flex: 1;
            padding: 15px;
            background: var(--bg-light);
            border: 2px solid var(--border);
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
            text-align: center;
        }

        .type-toggle-btn:hover {
            border-color: var(--primary);
        }

        .type-toggle-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .type-toggle-btn.statement.active {
            background: var(--info);
            border-color: var(--info);
        }

        .type-toggle-btn.zoom.active {
            background: var(--warning);
            border-color: var(--warning);
        }

        .question-form {
            background: var(--bg-light);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-gray);
        }

        input[type="text"],
        input[type="number"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            color: var(--text-white);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            transition: border-color 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .answer-options {
            display: grid;
            gap: 10px;
        }

        .answer-option {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .answer-option input[type="text"] {
            flex: 1;
        }

        .answer-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .add-answer-btn {
            padding: 8px 16px;
            background: var(--bg-dark);
            border: 2px dashed var(--border);
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
            margin-top: 10px;
        }

        .add-answer-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .zoom-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .zoom-level-selector {
            display: flex;
            gap: 10px;
        }

        .zoom-level-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .zoom-level-btn.active {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .zoom-style-selector {
            display: flex;
            gap: 10px;
        }

        .zoom-style-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .zoom-style-btn.active {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .zoom-preview {
            background: var(--bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
        }

        .zoom-coordinates {
            font-family: 'Courier Prime', monospace;
            color: var(--warning);
            margin-top: 10px;
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 91, 214, 0.4);
        }

        .btn-primary.statement {
            background: linear-gradient(135deg, var(--info), #3a8fd6);
        }

        .btn-primary.zoom {
            background: linear-gradient(135deg, var(--warning), #e67700);
        }

        .items-list {
            display: grid;
            gap: 15px;
        }

        .item-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        .item-card.statement {
            border-left-color: var(--info);
        }

        .item-card.zoom {
            border-left-color: var(--warning);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .item-card:hover {
            background: rgba(45, 91, 214, 0.1);
        }

        .item-timestamp {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-family: 'Courier Prime', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .item-card.statement .item-timestamp {
            background: var(--info);
        }

        .item-card.zoom .item-timestamp {
            background: var(--warning);
        }

        .item-type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 10px;
        }

        .item-type-badge.question {
            background: var(--primary);
            color: white;
        }

        .item-type-badge.statement {
            background: var(--info);
            color: white;
        }

        .item-type-badge.zoom {
            background: var(--warning);
            color: white;
        }

        .item-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .question-answers {
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }

        .answer-item {
            padding: 8px 12px;
            background: var(--bg-dark);
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .answer-item.correct {
            border: 2px solid var(--success);
            background: rgba(81, 207, 102, 0.1);
        }

        .item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }

        .btn-edit {
            background: var(--primary);
            color: white;
        }

        .btn-delete {
            background: var(--accent);
            color: white;
        }

        .btn-small:hover {
            transform: translateY(-2px);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .overlay.active {
            display: flex;
        }

        .overlay-content {
            background: var(--bg-mid);
            padding: 40px;
            border-radius: 16px;
            max-width: 90vw;
            max-height: 90vh;
            width: 800px;
            border: 2px solid var(--primary);
            animation: scaleIn 0.3s ease;
            overflow: auto;
        }

        .overlay-content.statement {
            border-color: var(--info);
        }

        .overlay-content.zoom {
            border-color: var(--warning);
            max-width: 95vw;
            width: 1200px;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .overlay-content h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--hpu-purple);
            font-weight: 700;
        }

        .overlay-content.statement h3 {
            color: var(--info);
        }

        .overlay-content.zoom h3 {
            color: var(--warning);
        }
        
        /* Make question text more readable */
        .overlay-content #overlayQuestionText {
            font-size: 1.4rem;
            line-height: 1.7;
            color: var(--text-white);
            font-weight: 600;
            background: rgba(51, 0, 114, 0.1);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--hpu-purple);
            margin-bottom: 25px;
        }

        .statement-text {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 12px;
            border-left: 4px solid var(--info);
        }

        .zoom-display {
            position: relative;
            margin-bottom: 25px;
        }

        .zoom-display video,
        .zoom-display iframe {
            width: 100%;
            max-height: 70vh;
            border-radius: 12px;
        }

        .zoom-highlight {
            position: absolute;
            border: 4px solid var(--warning);
            box-shadow: 0 0 20px rgba(255, 169, 77, 0.6);
            animation: zoomPulse 2s infinite;
            pointer-events: none;
        }

        .zoom-highlight.circle {
            border-radius: 50%;
        }

        .zoom-highlight.box {
            border-radius: 8px;
        }

        @keyframes zoomPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 169, 77, 0.6);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 40px rgba(255, 169, 77, 0.9);
            }
        }

        .zoom-text {
            font-size: 1.2rem;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 12px;
            border-left: 4px solid var(--warning);
            margin-bottom: 25px;
        }

        .quiz-answers {
            display: grid;
            gap: 12px;
            margin-bottom: 25px;
        }

        .quiz-answer {
            padding: 18px 24px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 1.1rem;
            color: #1a1f2e;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .quiz-answer:hover {
            border-color: var(--hpu-purple);
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(51, 0, 114, 0.2);
        }

        .quiz-answer.selected {
            border-color: var(--hpu-purple);
            background: var(--hpu-purple);
            color: white;
        }

        .quiz-answer.correct {
            border-color: var(--success);
            background: var(--success);
            color: white;
            font-weight: 600;
        }

        .quiz-answer.incorrect {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .quiz-feedback {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: rgba(81, 207, 102, 0.2);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .quiz-feedback.incorrect {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: none;
            animation: slideInRight 0.3s ease;
            z-index: 2000;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .notification.show {
            display: block;
        }

        .export-section {
            margin-top: 30px;
            padding: 25px;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .export-section h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .export-buttons {
            display: grid;
            gap: 10px;
        }

        .info-box {
            background: rgba(77, 171, 247, 0.1);
            border-left: 4px solid var(--info);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box.warning {
            background: rgba(255, 169, 77, 0.1);
            border-left-color: var(--warning);
        }

        .info-box h4 {
            color: var(--info);
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .info-box.warning h4 {
            color: var(--warning);
        }

        .info-box p {
            color: var(--text-gray);
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <header style="background: linear-gradient(135deg, var(--hpu-purple) 0%, var(--hpu-light-purple) 100%); padding: 25px 0; box-shadow: 0 4px 20px rgba(51, 0, 114, 0.3);">
        <div class="container" style="text-align: center;">
            <h1 style="margin: 0 0 10px 0; font-size: 2.5rem; font-weight: 700; color: #FFFFFF !important; text-shadow: none;">High Point University</h1>
            <p style="margin: 0 0 15px 0; font-size: 1.2rem; color: #FFFFFF !important; font-weight: 500; text-shadow: none;">Office of Accessibility Resources and Services (OARS)</p>
            <div style="height: 2px; width: 200px; background: rgba(255,255,255,0.6); margin: 0 auto 12px auto;"></div>
            <p class="subtitle" style="color: #FFFFFF !important; font-size: 1.1rem; margin: 0; font-weight: 500; text-shadow: none;">Interactive Video Tutorial Builder</p>
        </div>
    </header>

    <div class="container">
        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('create')">üìù Create</button>
            <button class="mode-btn" onclick="setMode('preview')">‚ñ∂Ô∏è Preview & Test</button>
        </div>

        <!-- Preview Mode Section -->
        <div id="previewMode" style="display: none;">
            <div class="panel" style="max-width: 1000px; margin: 0 auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>‚ñ∂Ô∏è Preview Your Interactive Video</h2>
                    <button class="control-btn" onclick="backToEditor()" style="background: var(--accent); font-size: 1rem; padding: 12px 24px;">‚¨ÖÔ∏è Back to Editor</button>
                </div>
                <p style="color: var(--text-gray); margin-bottom: 20px;">Click Play to start. Your interactive content will appear at the timestamps you set!</p>
                
                <div id="previewVideoSection">
                    <!-- Video will be cloned here -->
                </div>
            </div>
        </div>

        <div id="createMode" class="main-layout">
            <div class="panel">
                <h2>üìπ Video Setup</h2>
                
                <div class="video-source-tabs">
                    <button class="tab-btn active" onclick="setVideoSource('upload')">üìÅ Upload Video</button>
                    <button class="tab-btn" onclick="setVideoSource('youtube')">üì∫ YouTube URL</button>
                </div>

                <div id="uploadTab" class="upload-area" onclick="document.getElementById('videoInput').click()">
                    <div class="upload-icon">‚¨ÜÔ∏è</div>
                    <h3>Click or drag to upload video</h3>
                    <p style="color: var(--text-gray); margin-top: 10px;">Supports MP4, WebM, OGG</p>
                    <input type="file" id="videoInput" accept="video/*">
                </div>

                <div id="youtubeTab" class="youtube-input">
                    <div class="form-group">
                        <label>YouTube Video URL</label>
                        <input type="url" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=...">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="control-btn" onclick="loadYouTube()" style="flex: 1;">Load YouTube Video</button>
                        <button class="control-btn" onclick="loadTestVideo()" style="flex: 1; background: var(--success);">üß™ Test with Sample Video</button>
                    </div>
                    <p style="color: var(--text-gray); font-size: 0.9rem; margin-top: 10px;">
                        üí° Tip: Make sure your video is set to "Unlisted" or "Public" with embedding enabled
                    </p>
                </div>

                <div id="videoPlayerSection" style="display: none;">
                    <div class="video-container">
                        <div id="videoContainer" class="video-clickable"></div>
                        <div class="zoom-overlay" id="zoomOverlay"></div>
                    </div>
                    
                    <div class="video-controls">
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                            <button class="control-btn" onclick="skipBackward()" title="Skip back 5 seconds">‚è™ -5s</button>
                            <button class="control-btn" onclick="togglePlay()" id="playPauseBtn">‚ñ∂Ô∏è Play</button>
                            <button class="control-btn" onclick="skipForward()" title="Skip forward 5 seconds">‚è© +5s</button>
                            <button class="control-btn" onclick="useCurrentTime()">‚è±Ô∏è Use Current Time</button>
                            <div class="time-display" id="currentTime">00:00</div>
                            <div class="time-display" style="color: var(--text-gray);">/</div>
                            <div class="time-display" id="totalTime">00:00</div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 1;">
                                <input type="range" id="videoSeeker" min="0" max="100" value="0" style="width: 100%; cursor: pointer;">
                            </div>
                            <span style="color: var(--text-gray); font-size: 0.9rem;">üîä</span>
                            <input type="range" id="volumeControl" min="0" max="100" value="100" style="width: 100px; cursor: pointer;">
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>‚ú® Add Content</h2>

                <div class="info-box">
                    <h4>üí° Three Types Available:</h4>
                    <p><strong>Question:</strong> Quiz with multiple choice<br>
                    <strong>Statement:</strong> Display text/info<br>
                    <strong>Zoom:</strong> Highlight & zoom into video area</p>
                </div>
                
                <div class="type-toggle">
                    <button class="type-toggle-btn active" onclick="setContentType('question')">
                        ‚ùì Question
                    </button>
                    <button class="type-toggle-btn statement" onclick="setContentType('statement')">
                        üí¨ Statement
                    </button>
                    <button class="type-toggle-btn zoom" onclick="setContentType('zoom')">
                        üîç Zoom
                    </button>
                </div>

                <div class="question-form">
                    <div class="form-group">
                        <label>Timestamp (seconds)</label>
                        <input type="number" id="timestamp" placeholder="e.g., 30" min="0" step="0.1">
                    </div>

                    <!-- Question Form -->
                    <div id="questionForm">
                        <div class="form-group">
                            <label>Question</label>
                            <textarea id="questionText" placeholder="Enter your question here..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Answer Options</label>
                            <div class="answer-options" id="answerOptions">
                                <div class="answer-option">
                                    <input type="radio" name="correct" value="0" checked>
                                    <input type="text" placeholder="Answer option 1">
                                </div>
                                <div class="answer-option">
                                    <input type="radio" name="correct" value="1">
                                    <input type="text" placeholder="Answer option 2">
                                </div>
                            </div>
                            <button class="add-answer-btn" onclick="addAnswerOption()">+ Add Another Option</button>
                        </div>
                    </div>

                    <!-- Statement Form -->
                    <div id="statementForm" style="display: none;">
                        <div class="form-group">
                            <label>Statement Type</label>
                            <select id="statementType" onchange="handleStatementTypeChange()" style="width: 100%; padding: 12px; background: white; border: 2px solid var(--border); color: #1a1f2e; border-radius: 8px; font-size: 1rem; margin-bottom: 15px;">
                                <option value="note">üí¨ Note (Blue)</option>
                                <option value="tip">üí° Tip (Yellow)</option>
                                <option value="warning">‚ö†Ô∏è Warning (Red)</option>
                                <option value="keypoint">üìå Key Point (Green)</option>
                                <option value="definition">üéØ Definition (Purple)</option>
                                <option value="welcome">üé¨ Welcome (Intro)</option>
                                <option value="congrats">üéâ Congratulations (Ending)</option>
                                <option value="custom">‚ú® Custom Title...</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="customTitleSection" style="display: none;">
                            <label>Custom Title</label>
                            <input type="text" id="customStatementTitle" placeholder="Enter your custom title (e.g., 'Step 1 Instructions')" style="width: 100%; padding: 12px; background: var(--bg-dark); border: 2px solid var(--border); color: var(--text-white); border-radius: 8px; font-size: 1rem; margin-bottom: 15px;">
                        </div>
                        
                        <div class="form-group">
                            <label>Display Options</label>
                            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 5px;">Icon</label>
                                    <select id="statementShowIcon" style="width: 100%; padding: 10px; background: white; border: 2px solid var(--border); color: #1a1f2e; border-radius: 8px;">
                                        <option value="yes">Show Icon</option>
                                        <option value="no">No Icon (Text Only)</option>
                                    </select>
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 5px;">Size</label>
                                    <select id="statementSize" style="width: 100%; padding: 10px; background: white; border: 2px solid var(--border); color: #1a1f2e; border-radius: 8px;">
                                        <option value="small">Small</option>
                                        <option value="medium">Medium</option>
                                        <option value="large">Large</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Statement / Message</label>
                            <textarea id="statementText" placeholder="Enter your statement or message here..."></textarea>
                        </div>
                    </div>

                    <!-- Zoom Form -->
                    <div id="zoomForm" style="display: none;">
                        <div class="info-box warning">
                            <h4>üìç How to Set Zoom Area:</h4>
                            <p>1. Pause video at the right moment<br>
                            2. Click "Draw Zoom Box" button below<br>
                            3. Click and drag on the video to draw a rectangle<br>
                            4. Release to set the zoom area</p>
                        </div>

                        <div class="form-group">
                            <label>Zoom Duration (seconds)</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button class="zoom-level-btn" onclick="selectZoomDuration(3)">3 sec</button>
                                <button class="zoom-level-btn active" onclick="selectZoomDuration(5)">5 sec</button>
                                <button class="zoom-level-btn" onclick="selectZoomDuration(7)">7 sec</button>
                                <button class="zoom-level-btn" onclick="selectZoomDuration(10)">10 sec</button>
                            </div>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-top: 5px;">How long to stay zoomed (video keeps playing)</p>
                        </div>

                        <div class="zoom-preview" id="zoomPreview">
                            <button class="control-btn" id="drawZoomBtn" onclick="startDrawingZoom()" style="width: 100%; font-size: 1.1rem; padding: 15px;">
                                üéØ Draw Zoom Box on Video
                            </button>
                            <p style="color: var(--text-gray); margin-top: 10px; text-align: center;" id="zoomStatus">Click button above, then drag on video to draw zoom area</p>
                            <div class="zoom-coordinates" id="zoomCoordinates"></div>
                        </div>

                        <div class="form-group">
                            <label>Instruction Text (optional)</label>
                            <textarea id="zoomText" placeholder="e.g., 'Enter your name in this field' or 'Notice the date format here'"></textarea>
                        </div>
                    </div>

                    <button class="btn-primary" id="addBtn" onclick="addContent()">‚úÖ Add Question</button>
                </div>

                <!-- Certificate Settings Section -->
                <div class="panel" style="margin-top: 30px; border-left: 4px solid var(--hpu-purple);">
                    <h3 style="color: var(--hpu-purple);">üéì Certificate Settings</h3>
                    <p style="color: var(--text-gray); margin-bottom: 20px;">Customize the certificate that appears when viewers complete your tutorial</p>
                    
                    <div class="form-group">
                        <label>Tutorial Title (appears on certificate)</label>
                        <input type="text" id="certificateTitle" placeholder='e.g., "Glean Tutorial Review"' style="width: 100%; padding: 12px; background: var(--bg-dark); border: 2px solid var(--border); color: var(--text-white); border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div class="form-group">
                        <label>Certificate Message</label>
                        <textarea id="certificateMessage" placeholder="e.g., Your commitment to learning and professional development is appreciated." style="width: 100%; padding: 12px; background: var(--bg-dark); border: 2px solid var(--border); color: var(--text-white); border-radius: 8px; font-size: 1rem; min-height: 80px; font-family: 'Outfit', sans-serif;"></textarea>
                        <p style="color: var(--text-gray); font-size: 0.85rem; margin-top: 5px;">This message will appear on the certificate. Keep it warm and professional!</p>
                    </div>
                    
                    <div style="background: rgba(51, 0, 114, 0.1); border: 1px solid var(--hpu-purple); border-radius: 8px; padding: 15px; margin-top: 15px;">
                        <p style="color: var(--text-gray); font-size: 0.9rem; margin: 0;">
                            <strong style="color: var(--hpu-purple);">üìù Preview:</strong> Your certificate will include the HPU logo, OARS branding, completion date, and download options.
                        </p>
                    </div>
                </div>

                <div class="export-section">
                    <h3>üíæ Share Your Video</h3>
                    <div class="export-buttons">
                        <button class="control-btn" onclick="exportHTML()">üìÑ Download Complete HTML (SHARE THIS!)</button>
                        <button class="control-btn" onclick="exportJSON()">üíæ Download JSON (Backup)</button>
                    </div>
                    <p style="margin-top: 15px; color: var(--text-gray); font-size: 0.9rem;">
                        üí° Download the HTML file to share your interactive video with students/instructors. They can open it in any browser!
                    </p>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid var(--border);">
                        <h3>üì• Load Saved Work</h3>
                        <input type="file" id="jsonImportInput" accept=".json" style="display: none;" onchange="importJSON(event)">
                        <button class="control-btn" onclick="document.getElementById('jsonImportInput').click()" style="background: var(--success);">
                            üìÇ Import JSON Backup
                        </button>
                        <p style="margin-top: 10px; color: var(--text-gray); font-size: 0.9rem;">
                            üí° Load a previously saved JSON backup to continue editing
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>üìã Your Content (<span id="itemCount">0</span>)</h2>
            <div class="items-list" id="itemsList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <h3>No content yet</h3>
                    <p>Set up a video and add your first question, statement, or zoom point!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Question Overlay -->
    <div class="overlay" id="questionOverlay">
        <div class="overlay-content">
            <h3 id="overlayQuestionText"></h3>
            <div class="quiz-feedback" id="quizFeedback"></div>
            <div class="quiz-answers" id="quizAnswers"></div>
            <button class="btn-primary" onclick="continueVideo()">Continue Video</button>
        </div>
    </div>

    <!-- Statement Overlay -->
    <div class="overlay" id="statementOverlay">
        <div class="overlay-content statement">
            <h3>üí¨ Note</h3>
            <div class="statement-text" id="overlayStatementText"></div>
            <button class="btn-primary statement" onclick="continueVideo()">Continue Video</button>
        </div>
    </div>

    <!-- Zoom Overlay -->
    <div class="overlay" id="zoomOverlay">
        <div class="overlay-content zoom">
            <h3>üîç Focus Point</h3>
            <div class="zoom-text" id="overlayZoomText"></div>
            <div class="zoom-display">
                <div id="zoomVideoContainer"></div>
                <div id="zoomHighlight"></div>
            </div>
            <button class="btn-primary zoom" onclick="continueVideo()">Continue Video</button>
        </div>
    </div>

    <!-- Certificate Overlay -->
    <div class="overlay" id="certificateOverlay" style="display: none;">
        <div class="overlay-content" style="max-width: 700px; text-align: center; background: white; color: #000; border: 3px solid var(--hpu-purple); box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="background: linear-gradient(135deg, var(--hpu-purple) 0%, var(--hpu-light-purple) 100%); padding: 20px; margin: -20px -20px 20px -20px; border-radius: 12px 12px 0 0;">
                <h2 style="color: white; margin: 0; font-size: 1.8rem;">High Point University</h2>
                <p style="color: rgba(255,255,255,0.9); margin: 5px 0 0 0; font-size: 1rem;">Office of Accessibility Resources and Services (OARS)</p>
            </div>
            
            <div style="padding: 20px;">
                <h3 style="color: var(--hpu-purple); font-size: 1.8rem; margin-bottom: 20px; font-weight: 700;">Certificate of Completion</h3>
                
                <div style="height: 2px; width: 100px; background: var(--hpu-purple); margin: 0 auto 20px auto;"></div>
                
                <p style="color: #333; font-size: 1.1rem; line-height: 1.6; margin-bottom: 20px;">
                    Thank you for completing this tutorial!
                </p>
                
                <div style="background: rgba(51, 0, 114, 0.05); padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid var(--hpu-purple);">
                    <p id="certificateTitleDisplay" style="color: var(--hpu-purple); font-size: 1.3rem; font-weight: 600; margin: 0;"></p>
                </div>
                
                <p id="certificateMessageDisplay" style="color: #555; font-size: 1rem; line-height: 1.6; margin: 20px 0;"></p>
                
                <p style="color: #888; font-size: 0.95rem; margin: 20px 0;">
                    Completion Date: <span id="certificateDate"></span>
                </p>
                
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px;">
                    <button onclick="downloadCertificate('png')" style="background: var(--hpu-purple); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; font-weight: 600;">
                        üì• Download PNG
                    </button>
                    <button onclick="downloadCertificate('pdf')" style="background: var(--hpu-blue); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; font-weight: 600;">
                        üìÑ Download PDF
                    </button>
                </div>
                
                <button onclick="closeCertificate()" style="background: transparent; color: #888; border: none; padding: 12px 24px; margin-top: 15px; font-size: 0.95rem; cursor: pointer;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let items = [];
        let currentMode = 'create';
        let contentType = 'question';
        let videoElement = null;
        let youtubePlayer = null;
        let itemsShown = new Set();
        let videoSource = 'upload';
        let youtubeVideoId = '';
        let zoomDuration = 5; // Default 5 seconds
        let zoomBox = null; // {x, y, width, height} in percentages
        let isDrawingZoom = false;
        let zoomDrawStart = null;
        let selectingZoom = false;
        let lastVideoPosition = 0; // Remember where user was in video
        let activeZoom = null; // Currently active zoom animation

        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const videoInput = document.getElementById('videoInput');

            if (uploadArea) {
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('video/')) {
                        loadVideo(file);
                    }
                });
            }

            if (videoInput) {
                videoInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        loadVideo(file);
                    }
                });
            }
        });

        function setVideoSource(source) {
            videoSource = source;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (source === 'upload') {
                document.getElementById('uploadTab').style.display = 'block';
                document.getElementById('youtubeTab').classList.remove('active');
            } else {
                document.getElementById('uploadTab').style.display = 'none';
                document.getElementById('youtubeTab').classList.add('active');
            }
        }

        function setContentType(type) {
            console.log('setContentType called with:', type);
            contentType = type;
            document.querySelectorAll('.type-toggle-btn').forEach(btn => btn.classList.remove('active'));
            
            // Find the clicked button and make it active
            if (event && event.target) {
                event.target.classList.add('active');
            }

            const questionForm = document.getElementById('questionForm');
            const statementForm = document.getElementById('statementForm');
            const zoomForm = document.getElementById('zoomForm');
            const addBtn = document.getElementById('addBtn');

            console.log('Forms found:', {
                questionForm: !!questionForm,
                statementForm: !!statementForm,
                zoomForm: !!zoomForm,
                addBtn: !!addBtn
            });

            if (!questionForm || !statementForm || !zoomForm || !addBtn) {
                console.error('One or more form elements not found!');
                return;
            }

            questionForm.style.display = 'none';
            statementForm.style.display = 'none';
            zoomForm.style.display = 'none';

            if (type === 'question') {
                questionForm.style.display = 'block';
                addBtn.textContent = '‚úÖ Add Question';
                addBtn.className = 'btn-primary';
                console.log('Showing question form');
            } else if (type === 'statement') {
                statementForm.style.display = 'block';
                addBtn.textContent = '‚úÖ Add Statement';
                addBtn.className = 'btn-primary statement';
                console.log('Showing statement form');
            } else {
                zoomForm.style.display = 'block';
                addBtn.textContent = '‚úÖ Add Zoom Point';
                addBtn.className = 'btn-primary zoom';
                console.log('Showing zoom form');
            }
        }

        function loadVideo(file) {
            const url = URL.createObjectURL(file);
            const container = document.getElementById('videoContainer');
            container.innerHTML = '<video id="videoPlayer" controls></video>';
            
            videoElement = document.getElementById('videoPlayer');
            videoElement.src = url;
            videoSource = 'upload';
            
            document.getElementById('videoPlayerSection').style.display = 'block';
            showNotification('Video loaded successfully! üéâ');

            videoElement.addEventListener('timeupdate', handleTimeUpdate);
            videoElement.addEventListener('loadedmetadata', () => {
                document.getElementById('totalTime').textContent = formatTime(videoElement.duration);
            });
            setupVideoClickListener();
            setupVideoControls();
        }

        function loadYouTube() {
            const url = document.getElementById('youtubeUrl').value.trim();
            
            if (!url) {
                alert('Please enter a YouTube URL');
                return;
            }
            
            const videoId = extractYouTubeId(url);
            
            if (!videoId) {
                alert('‚ùå Could not extract video ID from URL.\n\nPlease make sure you\'re using:\n‚Ä¢ https://www.youtube.com/watch?v=VIDEO_ID\n‚Ä¢ https://youtu.be/VIDEO_ID\n\nYour URL: ' + url);
                return;
            }

            console.log('Loading YouTube video ID:', videoId);
            
            youtubeVideoId = videoId;
            const container = document.getElementById('videoContainer');
            
            // Create iframe WITHOUT origin parameter (causes issues with local files)
            // Use simple, reliable embed URL
            const embedUrl = 'https://www.youtube.com/embed/' + videoId + '?enablejsapi=1&rel=0&modestbranding=1';
            
            console.log('Embed URL:', embedUrl);
            
            container.innerHTML = '<iframe id="youtubePlayer" width="100%" height="400" src="' + embedUrl + '" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="border:none;"></iframe>';
            
            videoSource = 'youtube';
            document.getElementById('videoPlayerSection').style.display = 'block';
            
            // Check if iframe loaded
            setTimeout(() => {
                const iframe = document.getElementById('youtubePlayer');
                if (iframe) {
                    console.log('YouTube iframe created successfully');
                    showNotification('YouTube video loaded! üéâ');
                } else {
                    console.error('Failed to create YouTube iframe');
                    alert('‚ö†Ô∏è Failed to load YouTube video. Please try again.');
                }
            }, 500);

            // Load YouTube API and wait for it to be ready
            loadYouTubeAPI();
            setupVideoClickListener();
            setupVideoControls();
        }

        function loadTestVideo() {
            // Load a known working YouTube video for testing
            document.getElementById('youtubeUrl').value = 'https://www.youtube.com/watch?v=jNQXAC9IVRw';
            loadYouTube();
        }

        function extractYouTubeId(url) {
            // Enhanced regex to handle both youtu.be and youtube.com URLs
            let videoId = null;
            
            // Remove any query parameters we don't need (like si= tracking)
            url = url.split('&')[0]; // Remove everything after first &
            
            // Handle youtu.be format
            if (url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1].split(/[?&#]/)[0];
            }
            // Handle youtube.com/watch?v= format
            else if (url.includes('youtube.com/watch')) {
                const urlParams = new URLSearchParams(url.split('?')[1]);
                videoId = urlParams.get('v');
            }
            // Handle youtube.com/embed/ format (including ?si= parameters)
            else if (url.includes('youtube.com/embed/')) {
                videoId = url.split('embed/')[1].split(/[?&#]/)[0];
            }
            
            // Clean any remaining parameters from video ID
            if (videoId) {
                videoId = videoId.split('?')[0].split('&')[0].split('#')[0];
            }
            
            // Validate video ID (should be 11 characters)
            if (videoId && videoId.length === 11) {
                return videoId;
            }
            
            // Fallback to original regex
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7] && match[7].length === 11) ? match[7] : null;
        }

        function loadYouTubeAPI() {
            // Check if API is already loaded
            if (window.YT && window.YT.Player) {
                initYouTubePlayer();
                return;
            }
            
            // Load the API if not already loaded
            if (!window.YT) {
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                
                // Set up callback for when API is ready
                window.onYouTubeIframeAPIReady = function() {
                    initYouTubePlayer();
                };
                
                document.head.appendChild(tag);
            } else {
                // API is loading, wait for it
                setTimeout(() => {
                    loadYouTubeAPI();
                }, 500);
            }
        }

        function initYouTubePlayer() {
            // Destroy existing player if any
            if (youtubePlayer && youtubePlayer.destroy) {
                youtubePlayer.destroy();
            }
            
            try {
                youtubePlayer = new YT.Player('youtubePlayer', {
                    videoId: youtubeVideoId,
                    playerVars: {
                        'enablejsapi': 1,
                        'origin': window.location.origin,
                        'rel': 0,
                        'modestbranding': 1
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onError': onPlayerError
                    }
                });
            } catch (e) {
                console.error('Error initializing YouTube player:', e);
                showNotification('Error loading YouTube player. Video may still be processing. ‚ö†Ô∏è');
            }
        }
        
        function onPlayerReady(event) {
            showNotification('YouTube player ready! ‚úÖ');
            
            // Set total time
            if (youtubePlayer && youtubePlayer.getDuration) {
                const duration = youtubePlayer.getDuration();
                document.getElementById('totalTime').textContent = formatTime(duration);
            }
            
            setInterval(() => {
                if (youtubePlayer && youtubePlayer.getCurrentTime) {
                    try {
                        const time = youtubePlayer.getCurrentTime();
                        document.getElementById('currentTime').textContent = formatTime(time);
                        updateVideoSeeker();
                        if (currentMode === 'preview') {
                            checkForItems(time);
                        }
                    } catch (e) {
                        // Silently handle timing errors
                    }
                }
            }, 100);
        }
        
        function onPlayerError(event) {
            const errorMessages = {
                2: 'Invalid video ID. Please check your YouTube URL.',
                5: 'HTML5 player error. Try refreshing the page.',
                100: 'Video not found or has been removed.',
                101: 'Video owner does not allow embedding. Please check your video settings.',
                150: 'Video owner does not allow embedding. Please check your video settings.'
            };
            
            const errorCode = event.data;
            const message = errorMessages[errorCode] || 'Unknown error (Code: ' + errorCode + '). Video may still be processing.';
            
            alert('‚ö†Ô∏è YouTube Player Error\n\n' + message + '\n\nMake sure:\n1. Video is set to Unlisted or Public\n2. Embedding is enabled in YouTube settings\n3. Video has finished processing (wait 1-2 hours after upload)');
        }

        function setupVideoClickListener() {
            const container = document.getElementById('videoContainer');
            
            // Set up mouse events for drawing zoom boxes
            container.addEventListener('mousedown', handleZoomMouseDown);
            container.addEventListener('mousemove', handleZoomMouseMove);
            container.addEventListener('mouseup', handleZoomMouseUp);
            container.addEventListener('mouseleave', handleZoomMouseUp);
        }

        function startDrawingZoom() {
            isDrawingZoom = true;
            document.getElementById('drawZoomBtn').style.background = 'var(--accent)';
            document.getElementById('drawZoomBtn').textContent = '‚úèÔ∏è Now drag on the video!';
            document.getElementById('zoomStatus').textContent = 'Click and drag on the video to draw your zoom area';
            document.getElementById('videoContainer').style.cursor = 'crosshair';
            showNotification('Drag on the video to draw zoom box! üéØ');
        }

        function handleZoomMouseDown(e) {
            if (!isDrawingZoom) return;
            
            const rect = e.currentTarget.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            zoomDrawStart = { x, y };
            selectingZoom = true;
            
            // Create or update drawing rectangle
            let drawRect = document.getElementById('zoomDrawRect');
            if (!drawRect) {
                drawRect = document.createElement('div');
                drawRect.id = 'zoomDrawRect';
                drawRect.style.position = 'absolute';
                drawRect.style.border = '3px solid var(--warning)';
                drawRect.style.backgroundColor = 'rgba(255, 169, 77, 0.2)';
                drawRect.style.pointerEvents = 'none';
                drawRect.style.zIndex = '100';
                document.getElementById('zoomOverlay').appendChild(drawRect);
            }
            
            drawRect.style.left = x + '%';
            drawRect.style.top = y + '%';
            drawRect.style.width = '0';
            drawRect.style.height = '0';
            drawRect.style.display = 'block';
        }

        function handleZoomMouseMove(e) {
            if (!selectingZoom || !zoomDrawStart) return;
            
            const rect = e.currentTarget.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            const drawRect = document.getElementById('zoomDrawRect');
            if (!drawRect) return;
            
            const width = Math.abs(x - zoomDrawStart.x);
            const height = Math.abs(y - zoomDrawStart.y);
            const left = Math.min(x, zoomDrawStart.x);
            const top = Math.min(y, zoomDrawStart.y);
            
            drawRect.style.left = left + '%';
            drawRect.style.top = top + '%';
            drawRect.style.width = width + '%';
            drawRect.style.height = height + '%';
        }

        function handleZoomMouseUp(e) {
            if (!selectingZoom || !zoomDrawStart) return;
            
            const rect = e.currentTarget.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            const width = Math.abs(x - zoomDrawStart.x);
            const height = Math.abs(y - zoomDrawStart.y);
            const left = Math.min(x, zoomDrawStart.x);
            const top = Math.min(y, zoomDrawStart.y);
            
            // Only save if box has reasonable size (reduced threshold from 5% to 2%)
            if (width > 2 && height > 2) {
                zoomBox = { x: left, y: top, width: width, height: height };
                
                document.getElementById('zoomCoordinates').textContent = 
                    'Zoom area: ' + Math.round(width) + '% √ó ' + Math.round(height) + '% at (' + 
                    Math.round(left) + '%, ' + Math.round(top) + '%)';
                document.getElementById('zoomStatus').textContent = '‚úÖ Zoom area captured! Now add text and click "Add Zoom Point"';
                document.getElementById('zoomPreview').style.backgroundColor = 'rgba(255, 169, 77, 0.1)';
                showNotification('Zoom area captured! üéØ');
            } else {
                showNotification('Box too small! Try drawing a slightly larger area. ‚ö†Ô∏è');
                const drawRect = document.getElementById('zoomDrawRect');
                if (drawRect) drawRect.style.display = 'none';
            }
            
            selectingZoom = false;
            zoomDrawStart = null;
            isDrawingZoom = false;
            document.getElementById('drawZoomBtn').style.background = 'var(--primary)';
            document.getElementById('drawZoomBtn').textContent = 'üéØ Draw Zoom Box on Video';
            document.getElementById('videoContainer').style.cursor = 'default';
        }

        function selectZoomDuration(duration) {
            zoomDuration = duration;
            document.querySelectorAll('.zoom-level-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleTimeUpdate() {
            if (videoElement) {
                const time = videoElement.currentTime;
                const duration = videoElement.duration;
                document.getElementById('currentTime').textContent = formatTime(time);
                document.getElementById('totalTime').textContent = formatTime(duration);
                updateVideoSeeker();
                if (currentMode === 'preview') {
                    checkForItems(time);
                }
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
        }

        function togglePlay() {
            if (videoSource === 'upload' && videoElement) {
                if (videoElement.paused) {
                    videoElement.play();
                    document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è Pause';
                } else {
                    videoElement.pause();
                    document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Play';
                }
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.getPlayerState) {
                const state = youtubePlayer.getPlayerState();
                if (state === 1) {
                    youtubePlayer.pauseVideo();
                    document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Play';
                } else {
                    youtubePlayer.playVideo();
                    document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è Pause';
                }
            }
        }
        
        function skipForward() {
            if (videoSource === 'upload' && videoElement) {
                videoElement.currentTime = Math.min(videoElement.currentTime + 5, videoElement.duration);
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.seekTo) {
                const current = youtubePlayer.getCurrentTime();
                const duration = youtubePlayer.getDuration();
                youtubePlayer.seekTo(Math.min(current + 5, duration), true);
            }
        }
        
        function skipBackward() {
            if (videoSource === 'upload' && videoElement) {
                videoElement.currentTime = Math.max(videoElement.currentTime - 5, 0);
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.seekTo) {
                const current = youtubePlayer.getCurrentTime();
                youtubePlayer.seekTo(Math.max(current - 5, 0), true);
            }
        }
        
        function setupVideoControls() {
            // Setup video seeker
            const seeker = document.getElementById('videoSeeker');
            const volumeControl = document.getElementById('volumeControl');
            
            if (seeker) {
                // Remove old listener if exists
                seeker.removeEventListener('input', seekerInputHandler);
                seeker.addEventListener('input', seekerInputHandler);
            }
            
            // Setup volume control
            if (volumeControl) {
                // Remove old listener if exists
                volumeControl.removeEventListener('input', volumeInputHandler);
                volumeControl.addEventListener('input', volumeInputHandler);
            }
        }
        
        function seekerInputHandler() {
            const percentage = this.value;
            if (videoSource === 'upload' && videoElement) {
                const time = (percentage / 100) * videoElement.duration;
                videoElement.currentTime = time;
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.getDuration) {
                const time = (percentage / 100) * youtubePlayer.getDuration();
                youtubePlayer.seekTo(time, true);
            }
        }
        
        function volumeInputHandler() {
            const volume = this.value / 100;
            if (videoSource === 'upload' && videoElement) {
                videoElement.volume = volume;
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.setVolume) {
                youtubePlayer.setVolume(this.value);
            }
        }
        
        function updateVideoSeeker() {
            const seeker = document.getElementById('videoSeeker');
            if (!seeker) return;
            
            if (videoSource === 'upload' && videoElement && videoElement.duration) {
                const percentage = (videoElement.currentTime / videoElement.duration) * 100;
                seeker.value = percentage || 0;
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.getCurrentTime && youtubePlayer.getDuration) {
                try {
                    const current = youtubePlayer.getCurrentTime();
                    const duration = youtubePlayer.getDuration();
                    if (duration > 0) {
                        const percentage = (current / duration) * 100;
                        seeker.value = percentage || 0;
                    }
                } catch (e) {
                    // Silently handle errors
                }
            }
        }

        function useCurrentTime() {
            let time = 0;
            if (videoSource === 'upload' && videoElement) {
                time = Math.floor(videoElement.currentTime);
            } else if (videoSource === 'youtube' && youtubePlayer) {
                time = Math.floor(youtubePlayer.getCurrentTime());
            }
            document.getElementById('timestamp').value = time;
            showNotification('Timestamp captured! ‚è±Ô∏è');
        }

        function addAnswerOption() {
            const container = document.getElementById('answerOptions');
            const index = container.children.length;
            const div = document.createElement('div');
            div.className = 'answer-option';
            div.innerHTML = '<input type="radio" name="correct" value="' + index + '"><input type="text" placeholder="Answer option ' + (index + 1) + '">';
            container.appendChild(div);
        }

        function addContent() {
            const timestamp = parseFloat(document.getElementById('timestamp').value);
            
            if (!timestamp && timestamp !== 0) {
                alert('Please enter a timestamp');
                return;
            }

            if (contentType === 'question') {
                addQuestion(timestamp);
            } else if (contentType === 'statement') {
                addStatement(timestamp);
            } else {
                addZoom(timestamp);
            }
        }

        function addQuestion(timestamp) {
            const questionText = document.getElementById('questionText').value;
            const answerOptions = document.querySelectorAll('#answerOptions .answer-option');
            
            if (!questionText) {
                alert('Please enter a question');
                return;
            }

            const answers = [];
            let correctIndex = -1;

            answerOptions.forEach((option, index) => {
                const text = option.querySelector('input[type="text"]').value;
                const isCorrect = option.querySelector('input[type="radio"]').checked;
                if (text) {
                    answers.push(text);
                    if (isCorrect) correctIndex = answers.length - 1;
                }
            });

            if (answers.length < 2) {
                alert('Please add at least 2 answer options');
                return;
            }
            if (correctIndex === -1) {
                alert('Please select the correct answer');
                return;
            }

            items.push({
                type: 'question',
                timestamp: timestamp,
                question: questionText,
                answers: answers,
                correctIndex: correctIndex
            });

            items.sort((a, b) => a.timestamp - b.timestamp);
            renderItems();
            clearForm();
            showNotification('Question added! ‚úÖ');
        }

        function handleStatementTypeChange() {
            const type = document.getElementById('statementType').value;
            const customSection = document.getElementById('customTitleSection');
            
            if (type === 'custom') {
                customSection.style.display = 'block';
            } else {
                customSection.style.display = 'none';
            }
        }

        function addStatement(timestamp) {
            const statementText = document.getElementById('statementText').value;
            let statementType = document.getElementById('statementType').value;
            const showIcon = document.getElementById('statementShowIcon').value;
            const size = document.getElementById('statementSize').value;
            let customTitle = '';
            
            if (statementType === 'custom') {
                customTitle = document.getElementById('customStatementTitle').value.trim();
                if (!customTitle) {
                    alert('Please enter a custom title');
                    return;
                }
            }
            
            if (!statementText) {
                alert('Please enter a statement');
                return;
            }

            items.push({
                type: 'statement',
                statementType: statementType,
                customTitle: customTitle,
                showIcon: showIcon || 'yes',
                size: size || 'small',
                timestamp: timestamp,
                text: statementText
            });

            items.sort((a, b) => a.timestamp - b.timestamp);
            renderItems();
            clearForm();
            showNotification('Statement added! üí¨');
        }

        function addZoom(timestamp) {
            if (!zoomBox) {
                alert('Please click "Draw Zoom Box" and draw a rectangle on the video');
                return;
            }

            const zoomText = document.getElementById('zoomText').value;

            items.push({
                type: 'zoom',
                timestamp: timestamp,
                zoomBox: zoomBox,
                zoomDuration: zoomDuration,
                text: zoomText || ''
            });

            items.sort((a, b) => a.timestamp - b.timestamp);
            renderItems();
            clearForm();
            showNotification('Zoom area added! üîç');
        }

        function clearForm() {
            document.getElementById('timestamp').value = '';
            document.getElementById('questionText').value = '';
            document.getElementById('statementText').value = '';
            document.getElementById('zoomText').value = '';
            
            const container = document.getElementById('answerOptions');
            container.innerHTML = '<div class="answer-option"><input type="radio" name="correct" value="0" checked><input type="text" placeholder="Answer option 1"></div><div class="answer-option"><input type="radio" name="correct" value="1"><input type="text" placeholder="Answer option 2"></div>';
            
            zoomBox = null;
            document.getElementById('zoomCoordinates').textContent = '';
            document.getElementById('zoomPreview').style.backgroundColor = '';
            
            const zoomStatus = document.getElementById('zoomStatus');
            if (zoomStatus) {
                zoomStatus.textContent = 'Click button above, then drag on video to draw zoom area';
            }
            
            const drawRect = document.getElementById('zoomDrawRect');
            if (drawRect) drawRect.style.display = 'none';
            
            const customSection = document.getElementById('customTitleSection');
            if (customSection) customSection.style.display = 'none';
            
            const customTitle = document.getElementById('customStatementTitle');
            if (customTitle) customTitle.value = '';
            
            document.getElementById('zoomOverlay').innerHTML = '';
        }

        function renderItems() {
            const container = document.getElementById('itemsList');
            document.getElementById('itemCount').textContent = items.length;

            if (items.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><h3>No content yet</h3><p>Set up a video and add your first question, statement, or zoom point!</p></div>';
                return;
            }

            container.innerHTML = items.map((item, index) => {
                if (item.type === 'question') {
                    return '<div class="item-card"><div class="item-timestamp">' + formatTime(item.timestamp) + '</div><span class="item-type-badge question">QUESTION</span><div class="item-text">' + item.question + '</div><div class="question-answers">' + item.answers.map((answer, i) => {
                        return '<div class="answer-item ' + (i === item.correctIndex ? 'correct' : '') + '">' + (i === item.correctIndex ? '‚úì' : '‚óã') + ' ' + answer + '</div>';
                    }).join('') + '</div><div class="item-actions"><button class="btn-small btn-edit" onclick="editItem(' + index + ')">Edit</button><button class="btn-small btn-delete" onclick="deleteItem(' + index + ')">Delete</button><button class="btn-small btn-edit" onclick="jumpToTime(' + item.timestamp + ')">Jump</button></div></div>';
                } else if (item.type === 'statement') {
                    const statementLabels = {
                        'note': 'üí¨ NOTE',
                        'tip': 'üí° TIP',
                        'warning': '‚ö†Ô∏è WARNING',
                        'keypoint': 'üìå KEY POINT',
                        'definition': 'üéØ DEFINITION',
                        'welcome': 'üé¨ WELCOME',
                        'congrats': 'üéâ CONGRATS',
                        'custom': '‚ú® ' + (item.customTitle || 'CUSTOM').toUpperCase()
                    };
                    const label = statementLabels[item.statementType || 'note'];
                    const sizeLabel = item.size ? ' ‚Ä¢ ' + item.size.toUpperCase() : '';
                    const iconLabel = item.showIcon === 'no' ? ' ‚Ä¢ NO ICON' : '';
                    return '<div class="item-card statement"><div class="item-timestamp">' + formatTime(item.timestamp) + '</div><span class="item-type-badge statement">' + label + sizeLabel + iconLabel + '</span><div class="item-text">' + item.text + '</div><div class="item-actions"><button class="btn-small btn-edit" onclick="editItem(' + index + ')">Edit</button><button class="btn-small btn-delete" onclick="deleteItem(' + index + ')">Delete</button><button class="btn-small btn-edit" onclick="jumpToTime(' + item.timestamp + ')">Jump</button></div></div>';
                } else {
                    const boxInfo = item.zoomBox ? Math.round(item.zoomBox.width) + '% √ó ' + Math.round(item.zoomBox.height) + '% area' : 'Zoom area';
                    const duration = item.zoomDuration || 5;
                    return '<div class="item-card zoom"><div class="item-timestamp">' + formatTime(item.timestamp) + '</div><span class="item-type-badge zoom">ZOOM ‚Ä¢ ' + duration + 'SEC</span><div class="item-text">üîç ' + boxInfo + '</div>' + (item.text ? '<p style="margin-top:10px;color:var(--text-gray);">' + item.text + '</p>' : '') + '<div class="item-actions"><button class="btn-small btn-edit" onclick="editItem(' + index + ')">Edit</button><button class="btn-small btn-delete" onclick="deleteItem(' + index + ')">Delete</button><button class="btn-small btn-edit" onclick="jumpToTime(' + item.timestamp + ')">Jump</button></div></div>';
                }
            }).join('');
        }

        function deleteItem(index) {
            if (confirm('Are you sure you want to delete this item?')) {
                items.splice(index, 1);
                renderItems();
                showNotification('Item deleted');
            }
        }

        function editItem(index) {
            const item = items[index];
            document.getElementById('timestamp').value = item.timestamp;
            
            if (item.type === 'question') {
                setContentType('question');
                document.getElementById('questionText').value = item.question;
                
                const container = document.getElementById('answerOptions');
                container.innerHTML = item.answers.map((answer, i) => {
                    return '<div class="answer-option"><input type="radio" name="correct" value="' + i + '" ' + (i === item.correctIndex ? 'checked' : '') + '><input type="text" value="' + answer + '" placeholder="Answer option ' + (i + 1) + '"></div>';
                }).join('');
            } else if (item.type === 'statement') {
                setContentType('statement');
                document.getElementById('statementText').value = item.text;
                document.getElementById('statementType').value = item.statementType || 'note';
                document.getElementById('statementShowIcon').value = item.showIcon || 'yes';
                document.getElementById('statementSize').value = item.size || 'small';
                
                if (item.statementType === 'custom' && item.customTitle) {
                    document.getElementById('customTitleSection').style.display = 'block';
                    document.getElementById('customStatementTitle').value = item.customTitle;
                }
            } else {
                setContentType('zoom');
                zoomBox = item.zoomBox;
                zoomDuration = item.zoomDuration || 5;
                document.getElementById('zoomText').value = item.text;
                
                if (zoomBox) {
                    document.getElementById('zoomCoordinates').textContent = 
                        'Zoom area: ' + Math.round(zoomBox.width) + '% √ó ' + Math.round(zoomBox.height) + '% at (' + 
                        Math.round(zoomBox.x) + '%, ' + Math.round(zoomBox.y) + '%)';
                    document.getElementById('zoomStatus').textContent = '‚úÖ Zoom area loaded for editing';
                    
                    // Show the box on video
                    const drawRect = document.getElementById('zoomDrawRect');
                    if (!drawRect) {
                        const rect = document.createElement('div');
                        rect.id = 'zoomDrawRect';
                        rect.style.position = 'absolute';
                        rect.style.border = '3px solid var(--warning)';
                        rect.style.backgroundColor = 'rgba(255, 169, 77, 0.2)';
                        rect.style.pointerEvents = 'none';
                        rect.style.zIndex = '100';
                        document.getElementById('zoomOverlay').appendChild(rect);
                    }
                    const rect = document.getElementById('zoomDrawRect');
                    rect.style.left = zoomBox.x + '%';
                    rect.style.top = zoomBox.y + '%';
                    rect.style.width = zoomBox.width + '%';
                    rect.style.height = zoomBox.height + '%';
                    rect.style.display = 'block';
                }
                
                document.querySelectorAll('.zoom-level-btn').forEach(btn => btn.classList.remove('active'));
                const durationButtons = document.querySelectorAll('.zoom-level-btn');
                const durationIndex = [3, 5, 7, 10].indexOf(zoomDuration);
                if (durationIndex >= 0 && durationButtons[durationIndex]) {
                    durationButtons[durationIndex].classList.add('active');
                }
            }

            // Remove the item silently (without confirmation) since we're editing
            items.splice(index, 1);
            renderItems();
            showNotification('Editing - make changes and click Add to save! ‚úèÔ∏è');
            
            // Switch to create mode if in preview
            if (currentMode === 'preview') {
                currentMode = 'create';
                document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.mode-btn')[0].classList.add('active');
                document.getElementById('createMode').style.display = 'grid';
                document.getElementById('previewMode').style.display = 'none';
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function jumpToTime(time) {
            if (videoSource === 'upload' && videoElement) {
                videoElement.currentTime = time;
            } else if (videoSource === 'youtube' && youtubePlayer) {
                youtubePlayer.seekTo(time);
            }
            showNotification('Jumped to ' + formatTime(time));
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const createMode = document.getElementById('createMode');
            const previewMode = document.getElementById('previewMode');
            const videoPlayerSection = document.getElementById('videoPlayerSection');
            const previewVideoSection = document.getElementById('previewVideoSection');

            if (mode === 'create') {
                // Switching TO create mode
                createMode.style.display = 'grid';
                previewMode.style.display = 'none';
                itemsShown.clear();
                
                // Save position from preview video before stopping it
                const previewVideo = previewVideoSection.querySelector('video');
                if (previewVideo && !previewVideo.paused) {
                    lastVideoPosition = previewVideo.currentTime;
                    previewVideo.pause();
                }
                
                // Clear preview section completely
                previewVideoSection.innerHTML = '';
                
                // Restore position in create mode video
                if (videoElement && lastVideoPosition > 0) {
                    setTimeout(() => {
                        videoElement.currentTime = lastVideoPosition;
                    }, 100);
                }
                
            } else {
                // Switching TO preview mode
                if (items.length === 0) {
                    alert('Please add some content first!');
                    // Switch back to create mode
                    currentMode = 'create';
                    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.mode-btn')[0].classList.add('active');
                    return;
                }
                
                if (!videoPlayerSection || videoPlayerSection.style.display === 'none') {
                    alert('Please load a video first!');
                    currentMode = 'create';
                    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.mode-btn')[0].classList.add('active');
                    return;
                }
                
                // Save current position before switching
                if (videoElement) {
                    lastVideoPosition = videoElement.currentTime;
                    videoElement.pause();
                }
                if (youtubePlayer && youtubePlayer.pauseVideo) {
                    youtubePlayer.pauseVideo();
                }
                
                createMode.style.display = 'none';
                previewMode.style.display = 'block';
                
                // Clone the video player to preview section
                previewVideoSection.innerHTML = videoPlayerSection.innerHTML;
                
                // Setup the preview video
                const previewVideoEl = previewVideoSection.querySelector('video');
                if (previewVideoEl && videoElement) {
                    previewVideoEl.src = videoElement.src;
                    previewVideoEl.currentTime = 0; // Start from beginning in preview
                    
                    // Create temporary reference for preview
                    const originalVideoElement = videoElement;
                    videoElement = previewVideoEl;
                    videoElement.addEventListener('timeupdate', handleTimeUpdate);
                    
                    // Restore original reference when leaving preview
                    window.originalVideoElement = originalVideoElement;
                }
                
                // If it's YouTube, setup the preview player
                const previewYoutubeIframe = previewVideoSection.querySelector('iframe');
                if (previewYoutubeIframe && youtubeVideoId) {
                    setTimeout(() => {
                        if (window.YT && window.YT.Player) {
                            try {
                                youtubePlayer = new YT.Player(previewYoutubeIframe, {
                                    events: {
                                        'onReady': onPlayerReady,
                                        'onError': onPlayerError
                                    }
                                });
                            } catch (e) {
                                console.log('YouTube player setup:', e);
                            }
                        }
                    }, 500);
                }
                
                showNotification('Preview mode! Click Play to test. Use "Back to Editor" to return. ‚ñ∂Ô∏è');
                itemsShown.clear();
            }
        }
        
        function backToEditor() {
            // Restore original video reference
            if (window.originalVideoElement) {
                videoElement = window.originalVideoElement;
                delete window.originalVideoElement;
            }
            
            // Manually trigger mode switch
            currentMode = 'create';
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.mode-btn')[0].classList.add('active');
            
            const createMode = document.getElementById('createMode');
            const previewMode = document.getElementById('previewMode');
            const previewVideoSection = document.getElementById('previewVideoSection');
            
            createMode.style.display = 'grid';
            previewMode.style.display = 'none';
            
            // Stop preview video
            const previewVideo = previewVideoSection.querySelector('video');
            if (previewVideo) {
                lastVideoPosition = previewVideo.currentTime;
                previewVideo.pause();
            }
            
            // Clear preview
            previewVideoSection.innerHTML = '';
            
            // Restore position
            if (videoElement && lastVideoPosition > 0) {
                setTimeout(() => {
                    videoElement.currentTime = lastVideoPosition;
                }, 100);
            }
            
            showNotification('Back to editor! Continue where you left off. ‚úèÔ∏è');
            itemsShown.clear();
        }

        function checkForItems(currentTime) {
            items.forEach((item, index) => {
                if (!itemsShown.has(index) && currentTime >= item.timestamp && currentTime < item.timestamp + 1) {
                    if (item.type === 'question') {
                        showQuestion(item, index);
                    } else if (item.type === 'statement') {
                        showStatement(item, index);
                    } else {
                        showZoom(item, index);
                    }
                }
            });
            
            // Check for video completion to show certificate
            checkVideoCompletion(currentTime);
        }

        function showQuestion(item, index) {
            itemsShown.add(index);
            
            if (videoSource === 'upload' && videoElement) {
                videoElement.pause();
            } else if (videoSource === 'youtube' && youtubePlayer) {
                youtubePlayer.pauseVideo();
            }

            document.getElementById('overlayQuestionText').textContent = item.question;
            document.getElementById('quizFeedback').className = 'quiz-feedback';
            
            const answersContainer = document.getElementById('quizAnswers');
            answersContainer.innerHTML = item.answers.map((answer, i) => {
                return '<div class="quiz-answer" onclick="selectAnswer(' + i + ', ' + item.correctIndex + ')">' + answer + '</div>';
            }).join('');

            document.getElementById('questionOverlay').classList.add('active');
        }

        function showStatement(item, index) {
            itemsShown.add(index);
            
            if (videoSource === 'upload' && videoElement) {
                videoElement.pause();
            } else if (videoSource === 'youtube' && youtubePlayer) {
                youtubePlayer.pauseVideo();
            }

            // Get statement type info
            const statementTypes = {
                'note': { icon: 'üí¨', title: 'Note', color: 'var(--info)' },
                'tip': { icon: 'üí°', title: 'Tip', color: 'var(--warning)' },
                'warning': { icon: '‚ö†Ô∏è', title: 'Warning', color: 'var(--accent)' },
                'keypoint': { icon: 'üìå', title: 'Key Point', color: 'var(--success)' },
                'definition': { icon: 'üéØ', title: 'Definition', color: '#9775fa' },
                'welcome': { icon: 'üé¨', title: 'Welcome', color: 'var(--primary)' },
                'congrats': { icon: 'üéâ', title: 'Congratulations', color: 'var(--success)' },
                'custom': { icon: '‚ú®', title: item.customTitle || 'Custom', color: 'var(--primary)' }
            };
            
            const type = statementTypes[item.statementType || 'note'];
            
            // Use custom title if provided
            const displayTitle = (item.statementType === 'custom' && item.customTitle) ? item.customTitle : type.title;
            const showIcon = item.showIcon !== 'no';
            const size = item.size || 'small';
            
            // Update overlay heading and styling
            const overlay = document.getElementById('statementOverlay');
            const overlayContent = overlay.querySelector('.overlay-content');
            const heading = overlayContent.querySelector('h3');
            const textBox = document.getElementById('overlayStatementText');
            
            // Set heading with or without icon
            heading.textContent = showIcon ? (type.icon + ' ' + displayTitle) : displayTitle;
            heading.style.color = type.color;
            overlayContent.style.borderColor = type.color;
            textBox.style.borderLeftColor = type.color;
            
            // Set size
            const sizeMappings = {
                'small': { fontSize: '1.3rem', padding: '20px', maxWidth: '600px' },
                'medium': { fontSize: '1.6rem', padding: '30px', maxWidth: '800px' },
                'large': { fontSize: '2rem', padding: '40px', maxWidth: '1000px' }
            };
            
            const sizeSettings = sizeMappings[size];
            textBox.style.fontSize = sizeSettings.fontSize;
            textBox.style.padding = sizeSettings.padding;
            overlayContent.style.maxWidth = sizeSettings.maxWidth;
            
            document.getElementById('overlayStatementText').textContent = item.text;
            document.getElementById('statementOverlay').classList.add('active');
        }

        function showZoom(item, index) {
            itemsShown.add(index);
            
            // DON'T pause video - keep it playing!
            
            const container = document.getElementById('previewVideoSection') || document.getElementById('videoContainer');
            const videoEl = container.querySelector('video') || container.querySelector('iframe');
            
            if (!videoEl) return;
            
            // Create fullscreen zoom overlay
            let zoomOverlayDiv = document.getElementById('activeZoomOverlay');
            if (!zoomOverlayDiv) {
                zoomOverlayDiv = document.createElement('div');
                zoomOverlayDiv.id = 'activeZoomOverlay';
                zoomOverlayDiv.style.position = 'fixed';
                zoomOverlayDiv.style.top = '0';
                zoomOverlayDiv.style.left = '0';
                zoomOverlayDiv.style.width = '100%';
                zoomOverlayDiv.style.height = '100%';
                zoomOverlayDiv.style.pointerEvents = 'none';
                zoomOverlayDiv.style.zIndex = '999';
                zoomOverlayDiv.style.display = 'none';
                zoomOverlayDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.85)';
                document.body.appendChild(zoomOverlayDiv);
            }
            
            zoomOverlayDiv.innerHTML = '';
            zoomOverlayDiv.style.display = 'block';
            zoomOverlayDiv.style.opacity = '0';
            
            // Get video position and dimensions
            const videoRect = videoEl.getBoundingClientRect();
            const box = item.zoomBox;
            
            // Calculate the area to zoom (in pixels on the actual video)
            const sourceX = box.x; // percentage
            const sourceY = box.y; // percentage
            const sourceWidth = box.width; // percentage
            const sourceHeight = box.height; // percentage
            
            // Calculate zoom scale - how much bigger should it be?
            const screenWidth = window.innerWidth * 0.75;
            const screenHeight = window.innerHeight * 0.75;
            
            // How much to scale up
            const scaleX = screenWidth / (videoRect.width * sourceWidth / 100);
            const scaleY = screenHeight / (videoRect.height * sourceHeight / 100);
            const scale = Math.min(scaleX, scaleY, 4); // Max 4x zoom
            
            // Create a "window" that shows the zoomed portion
            const zoomWindow = document.createElement('div');
            zoomWindow.style.position = 'absolute';
            zoomWindow.style.left = '50%';
            zoomWindow.style.top = '50%';
            zoomWindow.style.transform = 'translate(-50%, -50%)';
            zoomWindow.style.width = (sourceWidth / 100 * videoRect.width * scale) + 'px';
            zoomWindow.style.height = (sourceHeight / 100 * videoRect.height * scale) + 'px';
            zoomWindow.style.border = '6px solid var(--warning)';
            zoomWindow.style.boxShadow = '0 0 60px rgba(255, 169, 77, 1)';
            zoomWindow.style.borderRadius = '12px';
            zoomWindow.style.overflow = 'hidden';
            zoomWindow.style.backgroundColor = '#000';
            
            // Take a canvas snapshot of the video area
            const canvas = document.createElement('canvas');
            const targetWidth = sourceWidth / 100 * videoRect.width * scale;
            const targetHeight = sourceHeight / 100 * videoRect.height * scale;
            canvas.width = targetWidth;
            canvas.height = targetHeight;
            const ctx = canvas.getContext('2d');
            
            // Function to continuously update the canvas with video frames
            function updateCanvas() {
                if (videoEl.tagName === 'VIDEO') {
                    // Calculate source rectangle on the video
                    const sx = (sourceX / 100) * videoEl.videoWidth;
                    const sy = (sourceY / 100) * videoEl.videoHeight;
                    const sw = (sourceWidth / 100) * videoEl.videoWidth;
                    const sh = (sourceHeight / 100) * videoEl.videoHeight;
                    
                    // Draw the cropped and scaled portion
                    ctx.drawImage(videoEl, sx, sy, sw, sh, 0, 0, targetWidth, targetHeight);
                } else {
                    // For iframe (YouTube), draw text message
                    ctx.fillStyle = '#1a1f2e';
                    ctx.fillRect(0, 0, targetWidth, targetHeight);
                    ctx.fillStyle = '#fff';
                    ctx.font = '20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Zoom effect active', targetWidth/2, targetHeight/2);
                    ctx.fillText('(Live zoom works with uploaded videos)', targetWidth/2, targetHeight/2 + 30);
                }
            }
            
            // Update canvas at ~30fps
            const animationInterval = setInterval(updateCanvas, 33);
            
            zoomWindow.appendChild(canvas);
            zoomOverlayDiv.appendChild(zoomWindow);
            
            // Add zoom indicator badge
            const zoomBadge = document.createElement('div');
            zoomBadge.style.position = 'absolute';
            zoomBadge.style.top = '10%';
            zoomBadge.style.left = '50%';
            zoomBadge.style.transform = 'translateX(-50%)';
            zoomBadge.style.padding = '12px 24px';
            zoomBadge.style.background = 'var(--warning)';
            zoomBadge.style.color = 'white';
            zoomBadge.style.borderRadius = '8px';
            zoomBadge.style.fontWeight = '700';
            zoomBadge.style.fontSize = '1.1rem';
            zoomBadge.style.boxShadow = '0 4px 20px rgba(0,0,0,0.5)';
            zoomBadge.textContent = 'üîç ' + Math.round(scale) + 'x Zoom';
            zoomOverlayDiv.appendChild(zoomBadge);
            
            // Add text overlay if provided
            if (item.text) {
                const textOverlay = document.createElement('div');
                textOverlay.style.position = 'absolute';
                textOverlay.style.bottom = '10%';
                textOverlay.style.left = '50%';
                textOverlay.style.transform = 'translateX(-50%)';
                textOverlay.style.padding = '16px 32px';
                textOverlay.style.background = 'rgba(255, 255, 255, 0.95)';
                textOverlay.style.color = '#000';
                textOverlay.style.borderRadius = '12px';
                textOverlay.style.fontWeight = '600';
                textOverlay.style.fontSize = '1.3rem';
                textOverlay.style.boxShadow = '0 8px 32px rgba(0,0,0,0.3)';
                textOverlay.style.maxWidth = '600px';
                textOverlay.style.textAlign = 'center';
                textOverlay.textContent = item.text;
                zoomOverlayDiv.appendChild(textOverlay);
            }
            
            // Fade in animation
            setTimeout(() => {
                zoomOverlayDiv.style.transition = 'opacity 0.5s ease';
                zoomOverlayDiv.style.opacity = '1';
            }, 50);
            
            // Fade out and remove after duration
            const duration = (item.zoomDuration || 5) * 1000;
            setTimeout(() => {
                clearInterval(animationInterval);
                zoomOverlayDiv.style.transition = 'opacity 0.5s ease';
                zoomOverlayDiv.style.opacity = '0';
                setTimeout(() => {
                    zoomOverlayDiv.style.display = 'none';
                    zoomOverlayDiv.innerHTML = '';
                }, 500);
            }, duration - 500);
        }

        function selectAnswer(selected, correct) {
            const answers = document.querySelectorAll('.quiz-answer');
            const feedback = document.getElementById('quizFeedback');
            
            answers.forEach((answer, i) => {
                answer.style.pointerEvents = 'none';
                if (i === correct) {
                    answer.classList.add('correct');
                } else if (i === selected) {
                    answer.classList.add('incorrect');
                }
            });

            if (selected === correct) {
                feedback.textContent = 'üéâ Correct! Great job!';
                feedback.className = 'quiz-feedback correct show';
            } else {
                feedback.textContent = '‚ùå Incorrect. The correct answer is highlighted.';
                feedback.className = 'quiz-feedback incorrect show';
            }
        }

        function continueVideo() {
            document.getElementById('questionOverlay').classList.remove('active');
            document.getElementById('statementOverlay').classList.remove('active');
            document.getElementById('zoomOverlay').classList.remove('active');
            
            if (videoSource === 'upload' && videoElement) {
                videoElement.play();
            } else if (videoSource === 'youtube' && youtubePlayer) {
                youtubePlayer.playVideo();
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function exportJSON() {
            const data = {
                items: items,
                videoSource: videoSource,
                youtubeVideoId: youtubeVideoId,
                certificateTitle: document.getElementById('certificateTitle').value || '',
                certificateMessage: document.getElementById('certificateMessage').value || '',
                created: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'interactive-video-backup.json';
            a.click();
            showNotification('JSON backup saved! üì•');
        }
        
        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Load items
                    if (data.items) {
                        items = data.items;
                        renderItems();
                    }
                    
                    // Load certificate settings
                    if (data.certificateTitle) {
                        document.getElementById('certificateTitle').value = data.certificateTitle;
                    }
                    if (data.certificateMessage) {
                        document.getElementById('certificateMessage').value = data.certificateMessage;
                    }
                    
                    // Load video info
                    if (data.videoSource === 'youtube' && data.youtubeVideoId) {
                        document.getElementById('youtubeUrl').value = 'https://www.youtube.com/watch?v=' + data.youtubeVideoId;
                        showNotification('‚úÖ JSON loaded! Click "Load YouTube Video" to reload your video, then continue editing!');
                    } else {
                        showNotification('‚úÖ JSON loaded! Upload your video again, then continue editing!');
                    }
                    
                    console.log('Loaded ' + items.length + ' items from JSON');
                    
                } catch (error) {
                    alert('‚ùå Error loading JSON file: ' + error.message);
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
            
            // Reset input so same file can be loaded again
            event.target.value = '';
        }

        function showCertificate() {
            const certTitle = document.getElementById('certificateTitle').value || 'Interactive Video Tutorial';
            const certMessage = document.getElementById('certificateMessage').value || 'Your commitment to learning and professional development is appreciated.';
            
            document.getElementById('certificateTitleDisplay').textContent = '"' + certTitle + '"';
            document.getElementById('certificateMessageDisplay').textContent = certMessage;
            
            const today = new Date();
            const dateStr = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('certificateDate').textContent = dateStr;
            
            document.getElementById('certificateOverlay').style.display = 'flex';
        }
        
        function closeCertificate() {
            document.getElementById('certificateOverlay').style.display = 'none';
        }
        
        function downloadCertificate(format) {
            // For now, show a message - full implementation would use html2canvas or similar
            if (format === 'png') {
                alert('üéì Certificate download feature coming soon!\\n\\nFor now, you can:\\n‚Ä¢ Take a screenshot (Print Screen)\\n‚Ä¢ Use browser Print ‚Üí Save as PDF\\n\\nFull download feature will be added in next update!');
            } else {
                // Open print dialog for PDF
                window.print();
            }
        }
        
        // Check if video completed to show certificate
        function checkVideoCompletion(currentTime) {
            if (videoSource === 'upload' && videoElement) {
                const duration = videoElement.duration;
                if (duration > 0 && currentTime >= duration - 1 && currentTime < duration) {
                    setTimeout(() => {
                        showCertificate();
                    }, 1000);
                }
            } else if (videoSource === 'youtube' && youtubePlayer && youtubePlayer.getDuration) {
                try {
                    const duration = youtubePlayer.getDuration();
                    if (duration > 0 && currentTime >= duration - 2 && currentTime < duration) {
                        setTimeout(() => {
                            showCertificate();
                        }, 1000);
                    }
                } catch (e) {
                    // Silently handle
                }
            }
        }

        function exportHTML() {
            if (items.length === 0) {
                alert('Please add some content first!');
                return;
            }

            if (videoSource === 'upload') {
                alert('‚ö†Ô∏è For best sharing results, use a YouTube video instead of an uploaded file.\n\nUploaded videos cannot be embedded in the HTML file.\n\nPlease:\n1. Upload your video to YouTube\n2. Use the YouTube URL in this tool\n3. Then export HTML');
                return;
            }

            const htmlContent = generateStandaloneHTML();
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'interactive-video-tutorial.html';
            a.click();
            showNotification('HTML file ready! Share it with anyone! üéâ');
        }

        function generateStandaloneHTML() {
            const styleContent = document.querySelector('style').textContent;
            
            return '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Interactive Video Tutorial</title><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"><style>' + styleContent + '</style></head><body><header><div class="container"><h1>üé¨ Interactive Video Tutorial</h1><p class="subtitle">Watch and learn with interactive questions, notes, and zoom highlights!</p></div></header><div class="container"><div class="panel"><div class="video-container"><div id="videoContainer"><iframe id="youtubePlayer" src="https://www.youtube.com/embed/' + youtubeVideoId + '?enablejsapi=1" allowfullscreen style="width:100%;height:500px;border:none;"></iframe></div></div><div class="video-controls" style="margin-top:20px;"><button class="control-btn" onclick="togglePlay()">‚ñ∂Ô∏è Play/Pause</button><div class="time-display" id="currentTime">00:00</div></div></div></div><div class="overlay" id="questionOverlay"><div class="overlay-content"><h3 id="overlayQuestionText"></h3><div class="quiz-feedback" id="quizFeedback"></div><div class="quiz-answers" id="quizAnswers"></div><button class="btn-primary" onclick="continueVideo()">Continue Video</button></div></div><div class="overlay" id="statementOverlay"><div class="overlay-content statement"><h3>üí¨ Note</h3><div class="statement-text" id="overlayStatementText"></div><button class="btn-primary statement" onclick="continueVideo()">Continue Video</button></div></div><div class="overlay" id="zoomOverlay"><div class="overlay-content zoom"><h3>üîç Focus Point</h3><div class="zoom-text" id="overlayZoomText"></div><div class="zoom-display"><div id="zoomVideoContainer"></div><div id="zoomHighlight"></div></div><button class="btn-primary zoom" onclick="continueVideo()">Continue Video</button></div></div><script>const items=' + JSON.stringify(items) + ';const youtubeVideoId="' + youtubeVideoId + '";let youtubePlayer=null;let itemsShown=new Set();const tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";document.head.appendChild(tag);function onYouTubeIframeAPIReady(){youtubePlayer=new YT.Player("youtubePlayer",{events:{onReady:()=>{setInterval(()=>{if(youtubePlayer&&youtubePlayer.getCurrentTime){const time=youtubePlayer.getCurrentTime();document.getElementById("currentTime").textContent=formatTime(time);checkForItems(time)}},100)}}})};function formatTime(s){const m=Math.floor(s/60);const sec=Math.floor(s%60);return String(m).padStart(2,"0")+":"+String(sec).padStart(2,"0")};function togglePlay(){if(youtubePlayer){const state=youtubePlayer.getPlayerState();if(state===1)youtubePlayer.pauseVideo();else youtubePlayer.playVideo()}};function checkForItems(currentTime){items.forEach((item,index)=>{if(!itemsShown.has(index)&&currentTime>=item.timestamp&&currentTime<item.timestamp+1){if(item.type==="question"){showQuestion(item,index)}else if(item.type==="statement"){showStatement(item,index)}else{showZoom(item,index)}}})};function showQuestion(item,index){itemsShown.add(index);if(youtubePlayer)youtubePlayer.pauseVideo();document.getElementById("overlayQuestionText").textContent=item.question;document.getElementById("quizFeedback").className="quiz-feedback";const ac=document.getElementById("quizAnswers");ac.innerHTML=item.answers.map((a,i)=>"<div class=\\"quiz-answer\\" onclick=\\"selectAnswer("+i+","+item.correctIndex+")\\">"+a+"</div>").join("");document.getElementById("questionOverlay").classList.add("active")};function showStatement(item,index){itemsShown.add(index);if(youtubePlayer)youtubePlayer.pauseVideo();document.getElementById("overlayStatementText").textContent=item.text;document.getElementById("statementOverlay").classList.add("active")};function showZoom(item,index){itemsShown.add(index);if(youtubePlayer)youtubePlayer.pauseVideo();const txt=document.getElementById("overlayZoomText");if(item.text){txt.textContent=item.text;txt.style.display="block"}else{txt.style.display="none"}const container=document.getElementById("zoomVideoContainer");const highlight=document.getElementById("zoomHighlight");container.innerHTML="<iframe src=\\"https://www.youtube.com/embed/"+youtubeVideoId+"?start="+Math.floor(item.timestamp)+"\\" allowfullscreen style=\\"width:100%;height:500px;border:none;\\"></iframe>";const size=100/item.zoomLevel;highlight.className="zoom-highlight "+item.zoomStyle;highlight.style.left=item.zoomPoint.x+"%";highlight.style.top=item.zoomPoint.y+"%";highlight.style.width=size+"%";highlight.style.height=size+"%";highlight.style.marginLeft="-"+(size/2)+"%";highlight.style.marginTop="-"+(size/2)+"%";document.getElementById("zoomOverlay").classList.add("active")};function selectAnswer(s,c){const ans=document.querySelectorAll(".quiz-answer");const fb=document.getElementById("quizFeedback");ans.forEach((a,i)=>{a.style.pointerEvents="none";if(i===c)a.classList.add("correct");else if(i===s)a.classList.add("incorrect")});if(s===c){fb.textContent="üéâ Correct! Great job!";fb.className="quiz-feedback correct show"}else{fb.textContent="‚ùå Incorrect. The correct answer is highlighted.";fb.className="quiz-feedback incorrect show"}};function continueVideo(){document.getElementById("questionOverlay").classList.remove("active");document.getElementById("statementOverlay").classList.remove("active");document.getElementById("zoomOverlay").classList.remove("active");if(youtubePlayer)youtubePlayer.playVideo()}<\/script></body></html>';
        }
    </script>
</body>
</html>